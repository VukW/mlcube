
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation site for MLCube">
      
      
        <meta name="author" content="<MLPerf.org> mlcommons@googlegroups.com">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-8.2.7">
    
    
      
        <title>MNIST - MLCube</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/circular.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mnist" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MLCube" class="md-header__button md-logo" aria-label="MLCube" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MLCube
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MNIST
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MLCube" class="md-nav__button md-logo" aria-label="MLCube" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MLCube
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hello-world/" class="md-nav__link">
        Hello World
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          MNIST
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        MNIST
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mnist-training-code" class="md-nav__link">
    MNIST training code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mlcube-implementation" class="md-nav__link">
    MLCube implementation
  </a>
  
    <nav class="md-nav" aria-label="MLCube implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-location" class="md-nav__link">
    Build location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlcube-definition-file" class="md-nav__link">
    MLCube definition file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/create-mlcube/" class="md-nav__link">
        How to Create an MLCube
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Runners
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Runners" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Runners
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/" class="md-nav__link">
        Runners
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/docker-runner/" class="md-nav__link">
        Docker Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/singularity-runner/" class="md-nav__link">
        Singularity Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/ssh-runner/" class="md-nav__link">
        SSH Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/kubernetes/" class="md-nav__link">
        Kubernetes Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/kubeflow/" class="md-nav__link">
        Kubeflow Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../runners/gcp-runner/" class="md-nav__link">
        GCP Runner
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mnist-training-code" class="md-nav__link">
    MNIST training code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mlcube-implementation" class="md-nav__link">
    MLCube implementation
  </a>
  
    <nav class="md-nav" aria-label="MLCube implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-location" class="md-nav__link">
    Build location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlcube-definition-file" class="md-nav__link">
    MLCube definition file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="mnist">MNIST<a class="headerlink" href="#mnist" title="Permanent link">&para;</a></h1>
<p>The <a href="http://yann.lecun.com/exdb/mnist/">MNIST dataset</a> is a collection of 60,000 handwritten digits widely used for
training statistical, Machine Learning (ML) and Deep Learning (DL) models. The MNIST MLCube example demonstrates
how data scientists, ML and DL researchers and developers can distribute their ML projects (including training,
validation and inference code) as MLCube cubes. MLCube establishes a standard to package user workloads,
and provides unified command line interface. In addition, MLCube provides a number of reference runners - python
packages that can run cubes on different platforms including 
<a href="https://mlcommons.github.io/mlcube/runners/docker-runner/">Docker</a>,
<a href="https://mlcommons.github.io/mlcube/runners/singularity-runner/">Singularity</a>,
<a href="https://mlcommons.github.io/mlcube/runners/kubeflow/">KubeFlow</a>
and several others.</p>
<blockquote>
<p>A data scientist has been working on a machine learning project. The goal is to train a simple neural network to
classify the collection of 60,000 small images into 10 classes. </p>
<p>The source files for this MNIST example can be found on  GitHub in MLCube Example <a href="https://github.com/mlcommons/mlcube_examples">repository</a>.</p>
</blockquote>
<h2 id="mnist-training-code">MNIST training code<a class="headerlink" href="#mnist-training-code" title="Permanent link">&para;</a></h2>
<p>Training an ML model is a process involving multiple steps such as downloading data, analyzing and cleaning data, 
splitting data into train/validation/test data sets, running hyper-parameter optimization experiments and performing final
model testing. MNIST dataset is a relatively small and well studied dataset that provides standard train/test split. In this simple
example a developer needs to implement two steps - (1) downloading data and (2) training a model. We call these steps
as <code>tasks</code>. Each task requires several parameters, such as a URL of the data set that we need to download, location on a
local disk where the data set will be downloaded to, path to a directory that will contain training artifacts such as log
files, training snapshots and Machine Learning models. We can characterize these two tasks in the following way:  </p>
<ul>
<li><code>Download</code> task:<ul>
<li><strong>Inputs</strong>: A yaml file (<code>data_config</code>) with two parameters - dataset URI and dataset hash.</li>
<li><strong>Outputs</strong>: Directory to serialize the data set (<code>data_dir</code>) and directory to serialize log files (<code>log_dir</code>).</li>
</ul>
</li>
<li><code>Training</code> task:<ul>
<li><strong>Inputs</strong>: Directory with MNIST data set (<code>data_dir</code>), training hyper-parameters defined in a file
   (<code>train_config</code>).</li>
<li><strong>Outputs</strong>:  Directory to store training results (<code>model_dir</code>) and directory to store log files (<code>log_dir</code>).</li>
</ul>
</li>
</ul>
<p>We have intentionally made all input/output parameters to be file system artifacts. By doing so, we support
reproducibility. Instead of command line arguments that can easily be lost, we store them in files. There are many
ways to implement the MNIST example. For simplicity, we assume the following:  </p>
<ul>
<li>We use one python file.  </li>
<li>Task name (download, train) is a command line positional parameter.  </li>
<li>Both tasks write logs, so it makes sense to add a parameter that defines a directory for log files.  </li>
<li>The download task accepts additional data directory parameter.   </li>
<li>The train task accepts such parameters as data and model directories, path to a file with hyper-parameter.</li>
<li>Configurable hyper-parameters are: (1) optimizer name, (2) number of training epochs and (3) global batch size. </li>
</ul>
<p>Then, our implementation could look like this. Parse command line arguments and identify a task to run. If it is 
the <code>download</code> task, call a function that downloads data sets. If it is the <code>train</code> task, train a model. This is sort 
of single entrypoint implementation where we run one script asking to perform various tasks. We run our script (mnist.py)
in the following way:
<code>python mnist.py download --data_config=PATH --data_dir=PATH --log_dir=PATH
python mnist.py train --train_config=PATH --data_dir=PATH --model_dir=PATH --log_dir=PATH</code></p>
<h2 id="mlcube-implementation">MLCube implementation<a class="headerlink" href="#mlcube-implementation" title="Permanent link">&para;</a></h2>
<p>Packaging our MNIST training script as a MLCube is done in several steps. We will be using a directory-based 
cube where a directory is structured in a certain way and contains specific files that make it MLCube compliant.
We need to create an empty directory on a local disk. Let's assume we call it <code>mnist</code> and we'll use
<code>{MLCUBE_ROOT}</code> to denote a full path to this directory. This is called an MLCube root directory. At this point this
directory is empty:
<code>mnist/</code></p>
<h3 id="build-location">Build location<a class="headerlink" href="#build-location" title="Permanent link">&para;</a></h3>
<p>The MLCube root directory will contain project source files, resources required for training, other files to recreate 
run time (such as requirements.txt, docker and singularity recipes etc.). We need to copy two files: mnist.py that 
implements training and requirements.txt that lists python dependencies. By doing so, we are enforcing reproducibility. 
A developer of this MLCube wants to make it easier to run their training workload in a great variety of environments 
including universities, commercial companies, HPC-friendly organizations such as national labs. One way to achieve it is 
to use container runtime such as docker or singularity. So, we'll provide both docker file and singularity recipe that 
we'll put into the MLCube root directory as well. Thus, we'll make this directory a build context. For reasons that we
will explain later, we also need to add .dockerignore file (that contains single line - <code>workspace/</code>). The MLCube 
directory now looks like:
<code>mnist/
  .dockerignore
  Dockerfile
  mnist.py
  requirements.txt
  Singularity.recipe</code>
A good test at this point would be to ensure that project is runnable from the build directory, and docker and 
singularity images can be built.  </p>
<h3 id="mlcube-definition-file">MLCube definition file<a class="headerlink" href="#mlcube-definition-file" title="Permanent link">&para;</a></h3>
<p>At this point we are ready to create a cube definition file. This is the first definition file that makes a folder to be
an MLCube folder. This is a YAML file that provides information such as name, author, version, named as <code>mlcube.yaml</code>
and located in the cube root directory . The most important section is the one that lists what tasks are implemented in
this cube:
```yaml</p>
<h1 id="name-of-this-mlcube">Name of this MLCube.<a class="headerlink" href="#name-of-this-mlcube" title="Permanent link">&para;</a></h1>
<p>name: mnist</p>
<h1 id="brief-description-for-this-mlcube">Brief description for this MLCube.<a class="headerlink" href="#brief-description-for-this-mlcube" title="Permanent link">&para;</a></h1>
<p>description: MLCommons MNIST MLCube example</p>
<h1 id="list-of-authorsdevelopers">List of authors/developers.<a class="headerlink" href="#list-of-authorsdevelopers" title="Permanent link">&para;</a></h1>
<p>authors:
  - name: "First Second"
    email: "first.second@company.com"
    org: "Company Inc."</p>
<h1 id="platform-description-this-is-where-users-can-specify-mlcube-resource-requirements-such-as">Platform description. This is where users can specify MLCube resource requirements, such as<a class="headerlink" href="#platform-description-this-is-where-users-can-specify-mlcube-resource-requirements-such-as" title="Permanent link">&para;</a></h1>
<h1 id="number-of-accelerators-memory-and-disk-requirements-etc-the-exact-structure-and-intended">number of accelerators, memory and disk requirements etc. The exact structure and intended<a class="headerlink" href="#number-of-accelerators-memory-and-disk-requirements-etc-the-exact-structure-and-intended" title="Permanent link">&para;</a></h1>
<h1 id="usage-of-information-in-this-section-is-work-in-progress-this-section-is-optional-now">usage of information in this section is work in progress. This section is optional now.<a class="headerlink" href="#usage-of-information-in-this-section-is-work-in-progress-this-section-is-optional-now" title="Permanent link">&para;</a></h1>
<p>platform:
  accelerator_count: 0
  accelerator_maker: NVIDIA
  accelerator_model: A100-80GB
  host_memory_gb: 40
  need_internet_access: True
  host_disk_space_gb: 100</p>
<h1 id="configuration-for-docker-runner-additional-options-can-be-configured-in-system-settings-file">Configuration for docker runner (additional options can be configured in system settings file).<a class="headerlink" href="#configuration-for-docker-runner-additional-options-can-be-configured-in-system-settings-file" title="Permanent link">&para;</a></h1>
<p>docker:
  image: mlcommons/mnist:0.0.1</p>
<h1 id="configuration-for-singularity-runner-additional-options-can-be-configured-in-system-settings">Configuration for singularity runner (additional options can be configured in system settings<a class="headerlink" href="#configuration-for-singularity-runner-additional-options-can-be-configured-in-system-settings" title="Permanent link">&para;</a></h1>
<h1 id="file">file).<a class="headerlink" href="#file" title="Permanent link">&para;</a></h1>
<p>singularity:
  image: mnist-0.0.1.simg</p>
<h1 id="section-where-mlcube-tasks-are-defined">Section where MLCube tasks are defined.<a class="headerlink" href="#section-where-mlcube-tasks-are-defined" title="Permanent link">&para;</a></h1>
<p>tasks:
  # <code>Download</code> task. It has one input and two output parameters.
  download:
    parameters:
      inputs: {data_config: data.yaml}
      outputs: {data_dir: data/, log_dir: logs/}
  # <code>Train</code> task. It has two input and two output parameters.
  train:
    parameters:
      inputs: {data_dir: data/, train_config: train.yaml}
      outputs: {log_dir: logs/, model_dir: model/}
<code>At this point, the directory looks like:</code>
mnist/
  .dockerignore
  Dockerfile
  mlcube.yaml
  mnist.py
  requirements.txt
  Singularity.recipe
```</p>
<h3 id="workspace">Workspace<a class="headerlink" href="#workspace" title="Permanent link">&para;</a></h3>
<p>The workspace is a directory inside cube (<code>workspace</code>) where, by default, input/output file system artifacts are
stored. There are multiple reasons to have one. One is to formally have default place for data sets, configuration
and log files etc. Having all these parameters in one place makes it simpler to run cubes on remote hosts and then
sync results back to users' local machines.</p>
<p>We need to be able to provide URI and hash of the MNIST dataset, collection of hyper-parameters and formally define a 
directory to store logs, models and MNIST data set. To do so, we create the directory tree <code>workspace/</code>, and then create 
two files with the following content (<code>data.yaml</code>):
<code>yaml
uri: https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz
hash: 731c5ac602752760c8e48fbffcf8c3b850d9dc2a2aedcf2cc48468fc17b673d1</code>
and <code>train.yaml</code>:
<code>yaml
optimizer: "adam"
train_epochs: 5
batch_size: 32</code><br />
At this point, the cube directory looks like:
<code>yaml
mnist/
  workspace/
    data.yaml
    train.yaml
  .dockerignore
  Dockerfile
  mlcube.yaml
  mnist.py
  requirements.txt
  Singularity.recipe</code></p>
<h2 id="mnist-mlcube-directory-structure-summary">MNIST MLCube directory structure summary<a class="headerlink" href="#mnist-mlcube-directory-structure-summary" title="Permanent link">&para;</a></h2>
<p><code>yaml
mnist/
  workspace/          # Default location for data sets, logs, models, parameter files.
    data.yaml         #   URI and hash of MNIST dataset.
    train.yaml        #   Train hyper-parameters.
  .dockerignore       # Docker ignore file that prevents workspace directory to be sent to docker server.
  Dockerfile          # Docker recipe.
  mlcube.yaml         # MLCube definition file.
  mnist.py            # Python source code training simple neural network using MNIST data set.
  requirements.txt    # Python project dependencies.
  Singularity.recipe  # Singularity recipe.</code></p>
<h2 id="running-mnist-mlcube">Running MNIST MLCube<a class="headerlink" href="#running-mnist-mlcube" title="Permanent link">&para;</a></h2>
<p>We need to set up the Python virtual environment. These are the steps outlined in the <code>Introduction</code> section except we 
do not clone GitHub repository with the example MLCube cubes. 
```</p>
<h1 id="create-python-virtual-environment">Create Python Virtual Environment<a class="headerlink" href="#create-python-virtual-environment" title="Permanent link">&para;</a></h1>
<p>virtualenv -p python3.6 ./env &amp;&amp; source ./env/bin/activate</p>
<h1 id="install-mlcube-docker-and-singularity-runners">Install MLCube Docker and Singularity runners<a class="headerlink" href="#install-mlcube-docker-and-singularity-runners" title="Permanent link">&para;</a></h1>
<p>pip install mlcube-docker mlcube-singularity
``` </p>
<blockquote>
<p>Before running MNIST cube below, it is probably a good idea to remove tasks' outputs from previous runs that are
located in the <code>workspace</code> directory. All directories except can be removed.</p>
</blockquote>
<h3 id="docker-runner">Docker Runner<a class="headerlink" href="#docker-runner" title="Permanent link">&para;</a></h3>
<p>Configure MNIST cube (this is optional step, docker runner checks if image exists, and if it does not, runs <code>configure</code>
phase automatically):
<code>mlcube configure --mlcube=. --platform=docker</code></p>
<p>Run two tasks - <code>download</code> (download data) and <code>train</code> (train tiny neural network):
<code>mlcube run --mlcube=. --platform=docker --task=download
mlcube run --mlcube=. --platform=docker --task=train</code></p>
<h3 id="singularity-runner">Singularity Runner<a class="headerlink" href="#singularity-runner" title="Permanent link">&para;</a></h3>
<p>Configure MNIST cube:
<code>mlcube configure --mlcube=. --platform=singularity</code></p>
<p>Run two tasks - <code>download</code> (download data) and <code>train</code> (train tiny neural network):
<code>mlcube run --mlcube=. --platform=singularity --task=download
mlcube run --mlcube=. --platform=singularity --task=train</code></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../hello-world/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Hello World" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Hello World
            </div>
          </div>
        </a>
      
      
        
        <a href="../../tutorials/create-mlcube/" class="md-footer__link md-footer__link--next" aria-label="Next: How to Create an MLCube" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              How to Create an MLCube
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
  </body>
</html>